# Mini Caching Proxy
This program is specifically designed to cache dynamic/pseudo-static web pages generated by a low-performance backend.

Since caching static files won't significantly improve performance in this scenario and may consume a huge amount of memory, additional setup (e.g., with nginx) to serve static files directly is recommended.

## Design
Its main purpose is to help low-cost websites (scripting language backend + cheap hosting) survive small- to medium-sized DDoS attacks. It caches your pages in memory and uses 2Q algorithm to keep memory usage down, newly cached pages are usually protected for a certain amount of time before becoming eligible for an LFU purge.

Considering that a typical low-end hosting server priced below $5/mo has 512MB~1GB of RAM, this caching proxy should work fine for a website containing a few thousand pages.

A few limitations to keep in mind:

* Login, auth, cookies won't work because these headers are intentionally stripped to prevent user-specific or privileged content being cached.
* The cache size limit configuration doesn't count any space taken by cache keys (request URI) and cached response headers, which theoretically can be pretty large.

## Usage
To keep it running on your server after logging out from ssh:
```sh
nohup minicache -f /path/to/config.json &
```
Or use a systemd service file:
```
[Unit]
After=network.target

[Service]
ExecStart=/path/to/minicache -f /path/to/config.json

[Install]
WantedBy=multi-user.target
```
Refer to [config.go](./util/config.go) for a full list of configurations and descriptions.

## Example with nginx
Proxy config:
```json
{"local_addr": ":9999", "target_addr": "http://127.0.0.1:2323"}
```

Nginx config:
```nginx
# The real backend (PHP)
server {
    listen 127.0.0.1:2323;
    root /var/www/html;
    location / {
        index index.php;
        try_files $uri $uri/ /index.php$is_args$args;
    }
    location ~ \.php {
        include fastcgi_params;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
    }
}
# Caching proxy
server {
    listen 80;
    root /var/www/html;
    location / {
        index index.php;
        try_files $uri $uri/ /index.php$is_args$args;
    }
    location ~ \.php$ {
        proxy_request_buffering off;
        proxy_redirect off;
        proxy_pass http://127.0.0.1:9999$request_uri;
    }
}
```